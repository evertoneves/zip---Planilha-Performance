<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Planilha de Performance</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/flowbite/1.8.1/flowbite.min.css" rel="stylesheet" />
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; }
        .pace-table th, .pace-table td { text-align: center; padding: 12px 8px; }
        .plan-table td { padding: 12px; }
        .completed-row { text-decoration: line-through; background-color: #f0fdf4; color: #6b7280; }
        .exercise-card { display: flex; flex-direction: column; justify-content: flex-start; height: 100%; min-height: 10rem; }
        .disabled-input { background-color: #e5e7eb; cursor: not-allowed; }
    </style>
</head>
<body class="antialiased">
    <div class="container mx-auto p-4 md:p-8 max-w-7xl">
        
        <header class="text-center mb-8">
            <h1 class="text-4xl font-bold text-gray-800">Planilha de Performance</h1>
            <p class="text-gray-600 mt-2">Sua jornada de corrida, guiada por dados. Calcule, planeje, fortale√ßa e conquiste.</p>
        </header>

        <!-- Se√ß√£o de ID de Usu√°rio e Vis√£o do Treinador -->
        <div class="mb-6 p-4 bg-white rounded-lg shadow-md border border-gray-200">
            <div class="flex flex-col md:flex-row gap-4 justify-between items-center">
                <div class="text-center md:text-left">
                    <p class="text-sm font-medium text-gray-700">Seu ID de Atleta (compartilhe com seu treinador):</p>
                    <p id="userIdDisplay" class="text-lg font-bold text-blue-600 bg-gray-100 p-2 rounded-md mt-1">Carregando...</p>
                </div>
                <div class="w-full md:w-auto">
                    <label for="coach-view-input" class="block text-sm font-medium text-gray-700">Vis√£o do Treinador (insira o ID do atleta):</label>
                    <div class="flex gap-2 mt-1">
                        <input type="text" id="coach-view-input" class="w-full p-2 border-gray-300 rounded-md shadow-sm" placeholder="ID do Atleta">
                        <button id="load-athlete-btn" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">Carregar</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Navega√ß√£o em Abas -->
        <div class="mb-4 border-b border-gray-200">
            <ul class="flex flex-wrap -mb-px text-sm font-medium text-center" id="myTab" data-tabs-toggle="#myTabContent" role="tablist">
                <li class="mr-2" role="presentation"><button class="inline-block p-4 border-b-2 rounded-t-lg" id="calculator-tab" data-tabs-target="#calculator" type="button" role="tab" aria-controls="calculator" aria-selected="true">üöÄ 1. Calculadora</button></li>
                <li class="mr-2" role="presentation"><button class="inline-block p-4 border-b-2 rounded-t-lg" id="plan-tab" data-tabs-target="#plan" type="button" role="tab" aria-controls="plan" aria-selected="false">üóìÔ∏è 2. Plano de Treino</button></li>
                <li class="mr-2" role="presentation"><button class="inline-block p-4 border-b-2 rounded-t-lg" id="dashboard-tab" data-tabs-target="#dashboard" type="button" role="tab" aria-controls="dashboard" aria-selected="false">üìä 3. Dashboard</button></li>
                <li class="mr-2" role="presentation"><button class="inline-block p-4 border-b-2 rounded-t-lg" id="strength-tab" data-tabs-target="#strength" type="button" role="tab" aria-controls="strength" aria-selected="false">ü§∏‚Äç‚ôÇÔ∏è 4. Fortalecimento</button></li>
                <li class="mr-2" role="presentation"><button class="inline-block p-4 border-b-2 rounded-t-lg" id="nutrition-tab" data-tabs-target="#nutrition" type="button" role="tab" aria-controls="nutrition" aria-selected="false">ü•ô 5. Nutri√ß√£o</button></li>
                <li role="presentation"><button class="inline-block p-4 border-b-2 rounded-t-lg" id="glossary-tab" data-tabs-target="#glossary" type="button" role="tab" aria-controls="glossary" aria-selected="false">üìñ 6. Gloss√°rio</button></li>
            </ul>
        </div>
        
        <!-- Conte√∫do das Abas -->
        <div id="myTabContent">
            <!-- Aba 1: Calculadora -->
            <div class="p-4 rounded-lg bg-white shadow-md" id="calculator" role="tabpanel" aria-labelledby="calculator-tab">
                <h2 class="text-2xl font-semibold text-gray-700 mb-4">Calcule seu VDOT e Ritmos de Treino</h2>
                <div class="grid md:grid-cols-2 gap-8 items-start">
                    <div>
                         <p class="text-gray-600 mb-6">Insira um resultado de prova recente ou, se for iniciante, escolha a op√ß√£o correspondente para descobrir seu VDOT e os ritmos para cada tipo de treino.</p>
                        <div class="space-y-4 p-6 bg-gray-50 rounded-lg border border-gray-200">
                            <div><label for="race-distance" class="block mb-2 text-sm font-medium text-gray-900">Selecione sua Refer√™ncia</label><select id="race-distance" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5"><option value="beginner">Iniciante (N√£o corro 5km)</option><option value="5000" selected>Prova de 5 km</option><option value="10000">Prova de 10 km</option><option value="21097">Meia Maratona (21.1 km)</option><option value="42195">Maratona (42.2 km)</option></select></div>
                             <div class="grid grid-cols-3 gap-2" id="time-inputs">
                                <div><label for="race-hours" class="block mb-2 text-sm font-medium text-gray-900">Horas</label><input type="number" id="race-hours" value="0" min="0" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg block w-full p-2.5"></div>
                                <div><label for="race-minutes" class="block mb-2 text-sm font-medium text-gray-900">Minutos</label><input type="number" id="race-minutes" value="25" min="0" max="59" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg block w-full p-2.5"></div>
                                <div><label for="race-seconds" class="block mb-2 text-sm font-medium text-gray-900">Segundos</label><input type="number" id="race-seconds" value="0" min="0" max="59" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg block w-full p-2.5"></div>
                            </div>
                            <button id="calculate-btn" class="w-full text-white bg-blue-600 hover:bg-blue-700 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center">Calcular</button>
                        </div>
                    </div>
                    <div id="results-area" class="hidden">
                        <div class="text-center bg-blue-800 text-white p-6 rounded-lg shadow-lg"><h3 class="text-lg font-medium">Seu VDOT √©:</h3><p id="vdot-score" class="text-6xl font-bold">--</p></div>
                        <div id="beginner-note" class="hidden mt-4 p-4 text-sm text-blue-800 rounded-lg bg-blue-50" role="alert">
                            <span class="font-medium">Nota para Iniciantes:</span> Seu VDOT inicial foi definido como 30. Este √© um ponto de partida seguro. Use os ritmos calculados e foque em completar os treinos. Ap√≥s 4-6 semanas, fa√ßa um teste de tempo em 3km ou 5km e insira o resultado aqui para obter um VDOT mais preciso.
                        </div>
                        <div class="mt-6"><h3 class="text-xl font-semibold text-gray-700 mb-2">Seus Ritmos de Treino</h3><div class="overflow-x-auto"><table class="w-full text-sm text-left text-gray-500 pace-table border border-gray-200"><thead class="text-xs text-gray-700 uppercase bg-gray-100"><tr><th class="px-6 py-3">Tipo de Treino</th><th class="px-6 py-3">Pace /km</th><th class="px-6 py-3">Pace /400m</th></tr></thead><tbody id="paces-table-body" class="bg-white"></tbody></table></div></div>
                    </div>
                </div>
            </div>

            <!-- Aba 2: Plano de Treino -->
            <div class="hidden p-4 rounded-lg bg-white shadow-md" id="plan" role="tabpanel" aria-labelledby="plan-tab">
                 <div class="flex flex-col md:flex-row justify-between md:items-center mb-6 gap-4 p-4 bg-gray-50 rounded-lg border">
                    <div class="flex-1">
                        <label for="plan-objective" class="block mb-1 text-sm font-medium text-gray-900">1. Escolha seu objetivo:</label>
                        <select id="plan-objective" class="bg-white border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5">
                            <option value="5k">Prova de 5km</option>
                            <option value="10k">Prova de 10km</option>
                            <option value="21k">Prova de 21km</option>
                            <option value="42k">Prova de 42km</option>
                        </select>
                    </div>
                     <div class="flex-1">
                        <label for="plan-days" class="block mb-1 text-sm font-medium text-gray-900">2. Quantos dias por semana?</label>
                        <select id="plan-days" class="bg-white border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5">
                            <option value="3">3 dias</option>
                            <option value="4" selected>4 dias</option>
                            <option value="5">5 dias</option>
                        </select>
                    </div>
                 </div>
                 <div>
                    <h2 class="text-2xl font-semibold text-gray-700">Seu Plano de Treino</h2>
                    <p id="plan-description" class="text-gray-600 mb-4"></p>
                 </div>
                 <div class="overflow-x-auto"><table id="training-plan-table" class="w-full text-sm text-left text-gray-600 plan-table"></table></div>
            </div>

            <!-- Aba 3: Dashboard -->
            <div class="hidden p-4 rounded-lg bg-white shadow-md" id="dashboard" role="tabpanel" aria-labelledby="dashboard-tab">
                 <h2 class="text-2xl font-semibold text-gray-700 mb-4">Seu Painel de Progresso</h2>
                 <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <div class="p-6 bg-gray-50 rounded-lg border text-center"><h3 class="font-semibold text-gray-600">Progresso do Plano</h3><div class="relative w-48 h-48 mx-auto mt-2"><canvas id="progressChart"></canvas><div id="progress-text" class="absolute inset-0 flex items-center justify-center text-3xl font-bold text-gray-800">0%</div></div></div>
                    <div class="p-6 bg-gray-50 rounded-lg border md:col-span-2"><h3 class="font-semibold text-gray-600 mb-2">Volume Semanal Planejado (km)</h3><canvas id="volumeChart"></canvas></div>
                 </div>
            </div>
            
            <!-- Aba 4: Fortalecimento -->
            <div class="hidden p-4 rounded-lg bg-white shadow-md" id="strength" role="tabpanel" aria-labelledby="strength-tab">
                <h2 class="text-2xl font-semibold text-gray-700 mb-4">Guia de Fortalecimento e Preven√ß√£o</h2>
                <div class="space-y-8">
                    <div>
                        <h3 class="text-xl font-semibold text-blue-700 mb-3">üî• Ativa√ß√£o Pr√©-Treino</h3>
                        <p class="text-gray-600 mb-4"><strong>Prop√≥sito:</strong> "Acordar" os m√∫sculos e aumentar a mobilidade das articula√ß√µes antes da corrida, preparando o corpo para o esfor√ßo.</p>
                        <div class="grid sm:grid-cols-2 lg:grid-cols-3 gap-6">
                            <div class="bg-gray-50 rounded-lg border p-4 text-center exercise-card"><strong class="text-gray-800">Caminhada de Minhoca</strong><p class="text-xs text-gray-500 mt-1">Comece em p√©, incline-se e caminhe com as m√£os para frente at√© a posi√ß√£o de prancha. Depois, caminhe com os p√©s em dire√ß√£o √†s m√£os.</p><p class="text-sm text-gray-600 mt-2 font-medium">5-8 repeti√ß√µes</p></div>
                            <div class="bg-gray-50 rounded-lg border p-4 text-center exercise-card"><strong class="text-gray-800">Agachamento Livre</strong><p class="text-xs text-gray-500 mt-1">Mantenha os p√©s na largura dos ombros. Des√ßa o quadril como se fosse sentar, mantendo o peito erguido e as costas retas.</p><p class="text-sm text-gray-600 mt-2 font-medium">15-20 repeti√ß√µes</p></div>
                            <div class="bg-gray-50 rounded-lg border p-4 text-center exercise-card"><strong class="text-gray-800">C√≠rculos Articulares</strong><p class="text-xs text-gray-500 mt-1">Gire lentamente os tornozelos, joelhos, quadris e ombros para lubrificar as articula√ß√µes antes do movimento.</p><p class="text-sm text-gray-600 mt-2 font-medium">10-15 por lado</p></div>
                        </div>
                    </div>
                    <div>
                        <h3 class="text-xl font-semibold text-green-700 mb-3">üèãÔ∏è Fortalecimento Essencial (2-3x por semana)</h3>
                        <p class="text-gray-600 mb-4"><strong>Prop√≥sito:</strong> Construir a for√ßa nos principais grupos musculares usados na corrida, o que melhora a performance e previne les√µes.</p>
                         <div class="grid sm:grid-cols-2 lg:grid-cols-3 gap-6">
                            <div class="bg-gray-50 rounded-lg border p-4 text-center exercise-card"><strong class="text-gray-800">Agachamento</strong><p class="text-xs text-gray-500 mt-1">Pode ser feito com peso. Des√ßa at√© que as coxas fiquem paralelas ao ch√£o, mantendo a forma correta e o abd√¥men contra√≠do.</p><p class="text-sm text-gray-600 mt-2 font-medium">3 s√©ries de 8-12</p></div>
                            <div class="bg-gray-50 rounded-lg border p-4 text-center exercise-card"><strong class="text-gray-800">Afundo (Avan√ßo)</strong><p class="text-xs text-gray-500 mt-1">D√™ um passo √† frente e flexione ambos os joelhos a 90 graus. O joelho de tr√°s quase toca o ch√£o. Alterne as pernas.</p><p class="text-sm text-gray-600 mt-2 font-medium">3 s√©ries de 10-15/perna</p></div>
                            <div class="bg-gray-50 rounded-lg border p-4 text-center exercise-card"><strong class="text-gray-800">Eleva√ß√£o de Panturrilha</strong><p class="text-xs text-gray-500 mt-1">Fique em p√© e eleve os calcanhares o m√°ximo que puder, contraindo as panturrilhas. Des√ßa lentamente.</p><p class="text-sm text-gray-600 mt-2 font-medium">3 s√©ries de 15-20</p></div>
                            <div class="bg-gray-50 rounded-lg border p-4 text-center exercise-card"><strong class="text-gray-800">Prancha</strong><p class="text-xs text-gray-500 mt-1">Apoie-se nos antebra√ßos e pontas dos p√©s, mantendo o corpo reto da cabe√ßa aos calcanhares. Contraia o abd√¥men.</p><p class="text-sm text-gray-600 mt-2 font-medium">3 s√©ries de 30-60s</p></div>
                            <div class="bg-gray-50 rounded-lg border p-4 text-center exercise-card"><strong class="text-gray-800">Ponte de Gl√∫teos</strong><p class="text-xs text-gray-500 mt-1">Deite-se de costas com os joelhos dobrados. Eleve o quadril em dire√ß√£o ao teto, contraindo os gl√∫teos. Segure e des√ßa.</p><p class="text-sm text-gray-600 mt-2 font-medium">3 s√©ries de 12-15</p></div>
                        </div>
                    </div>
                    <div>
                        <h3 class="text-xl font-semibold text-purple-700 mb-3">üßò Mobilidade P√≥s-Treino</h3>
                        <p class="text-gray-600 mb-4"><strong>Prop√≥sito:</strong> Ajudar na recupera√ß√£o, relaxar a musculatura e restaurar a amplitude de movimento ap√≥s o treino.</p>
                         <div class="grid sm:grid-cols-2 lg:grid-cols-3 gap-6">
                            <div class="bg-gray-50 rounded-lg border p-4 text-center exercise-card"><strong class="text-gray-800">Along. Isquiotibiais</strong><p class="text-xs text-gray-500 mt-1">Sentado ou em p√©, estenda uma perna e incline o tronco para a frente, mantendo as costas retas, at√© sentir alongar atr√°s da coxa.</p><p class="text-sm text-gray-600 mt-2 font-medium">Sustente 30s/perna</p></div>
                            <div class="bg-gray-50 rounded-lg border p-4 text-center exercise-card"><strong class="text-gray-800">Along. Quadr√≠ceps</strong><p class="text-xs text-gray-500 mt-1">Em p√©, puxe um dos p√©s em dire√ß√£o ao gl√∫teo, mantendo os joelhos juntos e o quadril alinhado para frente.</p><p class="text-sm text-gray-600 mt-2 font-medium">Sustente 30s/perna</p></div>
                            <div class="bg-gray-50 rounded-lg border p-4 text-center exercise-card"><strong class="text-gray-800">Along. Piriforme (4)</strong><p class="text-xs text-gray-500 mt-1">Deitado, cruze um tornozelo sobre o joelho oposto e puxe a perna de baixo em dire√ß√£o ao peito.</p><p class="text-sm text-gray-600 mt-2 font-medium">Sustente 30s/perna</p></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Aba 5: Nutri√ß√£o -->
            <div class="hidden p-4 rounded-lg bg-white shadow-md" id="nutrition" role="tabpanel" aria-labelledby="nutrition-tab">
                 <h2 class="text-2xl font-semibold text-gray-700 mb-1">Guia de Nutri√ß√£o e Hidrata√ß√£o</h2>
                 <p class="text-gray-600 mb-6">O que voc√™ come e bebe √© t√£o importante quanto seu treino. Use estas dicas como ponto de partida. Para planos detalhados, consulte um nutricionista.</p>
                 <div class="space-y-8">
                    <div>
                        <h3 class="text-xl font-semibold text-orange-700 mb-3">üïí Antes do Treino</h3>
                        <ul class="list-disc list-inside text-gray-600 space-y-2">
                            <li><strong>1-2 horas antes:</strong> Consuma uma refei√ß√£o ou lanche rico em carboidratos de f√°cil digest√£o (ex: banana, p√£o com geleia, aveia) para garantir que seus estoques de energia estejam cheios.</li>
                            <li><strong>Evite:</strong> Alimentos muito gordurosos, fibrosos ou pesados, que podem causar desconforto g√°strico.</li>
                            <li><strong>Hidrata√ß√£o:</strong> Beba cerca de 500ml de √°gua nas 2 horas que antecedem a corrida.</li>
                        </ul>
                    </div>
                     <div>
                        <h3 class="text-xl font-semibold text-cyan-700 mb-3">üíß Durante o Treino</h3>
                        <ul class="list-disc list-inside text-gray-600 space-y-2">
                            <li><strong>Treinos at√© 60 minutos:</strong> Geralmente, apenas √°gua √© suficiente, a menos que esteja muito quente.</li>
                            <li><strong>Treinos acima de 60-75 minutos:</strong> Comece a repor carboidratos (30-60g por hora) atrav√©s de g√©is, gomas ou bebidas esportivas para manter a intensidade.</li>
                            <li><strong>Hidrata√ß√£o Cont√≠nua:</strong> Beba pequenos goles de √°gua ou isot√¥nico a cada 15-20 minutos. N√£o espere sentir sede!</li>
                        </ul>
                    </div>
                     <div>
                        <h3 class="text-xl font-semibold text-emerald-700 mb-3">‚úÖ Depois do Treino</h3>
                        <ul class="list-disc list-inside text-gray-600 space-y-2">
                            <li><strong>A Janela de Ouro (30-60 min ap√≥s):</strong> Consuma uma combina√ß√£o de carboidratos e prote√≠nas (propor√ß√£o de 3:1 ou 4:1) para repor a energia gasta e iniciar a repara√ß√£o muscular.</li>
                            <li><strong>Exemplos:</strong> Vitamina de frutas com leite ou iogurte, p√£o com ovos, ou um shake de prote√≠na com uma banana.</li>
                            <li><strong>Reidrata√ß√£o:</strong> Continue bebendo √°gua ou √°gua de coco nas horas seguintes para repor todos os fluidos e eletr√≥litos perdidos.</li>
                        </ul>
                    </div>
                 </div>
            </div>
            
             <!-- Aba 6: Gloss√°rio -->
            <div class="hidden p-4 rounded-lg bg-white shadow-md" id="glossary" role="tabpanel" aria-labelledby="glossary-tab">
                 <h2 class="text-2xl font-semibold text-gray-700 mb-4">Entendendo seu Treino</h2>
                <div class="space-y-6">
                    <div><h3 class="text-lg font-semibold text-blue-800">O que √© VDOT?</h3><p class="text-gray-600 mt-1">VDOT √© um valor que representa sua capacidade de corrida atual. Foi popularizado pelo renomado treinador Jack Daniels. Ele permite determinar ritmos de treino precisos e prever tempos de prova em diferentes dist√¢ncias. Quanto maior o VDOT, melhor o seu condicionamento aer√≥bico.</p></div>
                    <div class="border-t pt-6"><h3 class="text-lg font-semibold text-blue-800">As Zonas de Treino</h3>
                        <dl class="mt-2 space-y-4">
                            <div class="p-4 bg-green-50 rounded-lg"><dt class="font-semibold text-green-800">Ritmo F√°cil (E - Easy)</dt><dd class="text-gray-600 mt-1"><strong>Prop√≥sito:</strong> Construir base aer√≥bica, promover recupera√ß√£o e fortalecer o sistema cardiovascular. √â o "p√£o com manteiga" do treino. A maior parte do seu volume semanal deve ser neste ritmo.</dd></div>
                            <div class="p-4 bg-yellow-50 rounded-lg"><dt class="font-semibold text-yellow-800">Ritmo de Maratona (M - Marathon)</dt><dd class="text-gray-600 mt-1"><strong>Prop√≥sito:</strong> Adaptar o corpo √† demanda espec√≠fica de uma prova longa. √â um ritmo confortavelmente dif√≠cil que pode ser sustentado por um longo tempo.</dd></div>
                            <div class="p-4 bg-orange-50 rounded-lg"><dt class="font-semibold text-orange-800">Ritmo de Limiar (T - Threshold)</dt><dd class="text-gray-600 mt-1"><strong>Prop√≥sito:</strong> Melhorar a resist√™ncia √† fadiga, aumentando o ponto em que o lactato se acumula nos m√∫sculos. S√£o treinos desafiadores, mas controlados (sensa√ß√£o de "ritmo de cruzeiro").</dd></div>
                            <div class="p-4 bg-red-50 rounded-lg"><dt class="font-semibold text-red-800">Ritmo de Intervalado (I - Interval)</dt><dd class="text-gray-600 mt-1"><strong>Prop√≥sito:</strong> Aumentar o consumo m√°ximo de oxig√™nio (VO2 m√°ximo), o "teto" da sua capacidade aer√≥bica. S√£o treinos de alta intensidade, com intervalos de 3 a 5 minutos.</dd></div>
                            <div class="p-4 bg-purple-50 rounded-lg"><dt class="font-semibold text-purple-800">Ritmo de Repeti√ß√£o (R - Repetition)</dt>
                                <dd class="text-gray-600 mt-1">
                                    Prop√≥sito: Melhorar a velocidade pura e a economia de corrida (efici√™ncia mec√¢nica). O foco aqui n√£o √© o sistema cardiovascular, mas sim o neuromuscular: ensinar seu corpo a correr r√°pido com boa forma.
                                </dd>
                            </div>
                        </dl>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase Scripts -->
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, onSnapshot, updateDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

        // ====================================================================================
        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyA1P9R-syb325R7Cr87LoVunyFwykeKV7Q",
            authDomain: "zip---planilha-performance.firebaseapp.com",
            projectId: "zip---planilha-performance",
            storageBucket: "zip---planilha-performance.appspot.com",
            messagingSenderId: "271108471268",
            appId: "1:271108471268:web:9aa8ade28528b61e576ff1",
            measurementId: "G-9C5FC135P3"
        };
        // ====================================================================================

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        const VDOTApp = {};

        // --- DADOS E L√ìGICA ---
        VDOTApp.vdotData = {
            30: { E: "07:05", M: "06:14", T: "05:49", I: "05:19", R:"01:19", pace400I: "02:08" }, 35: { E: "06:26", M: "05:39", T: "05:16", I: "04:49", R:"01:12", pace400I: "01:56" }, 40: { E: "05:56", M: "05:11", T: "04:49", I: "04:22", R:"01:05", pace400I: "01:45" }, 45: { E: "05:30", M: "04:47", T: "04:26", I: "04:00", R:"01:00", pace400I: "01:36" }, 50: { E: "05:08", M: "04:26", T: "04:06", I: "03:41", R:"00:55", pace400I: "01:28" }, 55: { E: "04:49", M: "04:08", T: "03:49", I: "03:25", R:"00:51", pace400I: "01:22" }, 60: { E: "04:32", M: "03:52", T: "03:34", I: "03:12", R:"00:48", pace400I: "01:17" }, 65: { E: "04:17", M: "03:38", T: "03:21", I: "03:00", R:"00:45", pace400I: "01:12" }, 70: { E: "04:04", M: "03:26", T: "03:10", I: "02:50", R:"00:42", pace400I: "01:08" }
        };

        const timeToSeconds = (time) => { const parts = time.split(':').map(Number); return parts[0] * 60 + parts[1]; };
        VDOTApp.getVdotFrom5k = (s) => { if (s > timeToSeconds("30:20")) return 30; if (s > timeToSeconds("27:00")) return 35; if (s > timeToSeconds("24:05")) return 40; if (s > timeToSeconds("21:40")) return 45; if (s > timeToSeconds("19:40")) return 50; if (s > timeToSeconds("18:00")) return 55; if (s > timeToSeconds("16:35")) return 60; if (s > timeToSeconds("15:24")) return 65; return 70; };
        VDOTApp.getVdotFrom10k = (s) => { if (s > timeToSeconds("62:30")) return 30; if (s > timeToSeconds("55:40")) return 35; if (s > timeToSeconds("49:40")) return 40; if (s > timeToSeconds("44:30")) return 45; if (s > timeToSeconds("40:15")) return 50; if (s > timeToSeconds("36:40")) return 55; if (s > timeToSeconds("33:45")) return 60; if (s > timeToSeconds("31:15")) return 65; return 70; };
        VDOTApp.getVdotFrom21k = (s) => { if (s > timeToSeconds("131:50")) return 30; if (s > timeToSeconds("117:30")) return 35; if (s > timeToSeconds("105:00")) return 40; if (s > timeToSeconds("94:30")) return 45; if (s > timeToSeconds("85:40")) return 50; if (s > timeToSeconds("78:20")) return 55; if (s > timeToSeconds("71:50")) return 60; if (s > timeToSeconds("66:20")) return 65; return 70; };
        VDOTApp.getVdotFrom42k = (s) => { if (s > timeToSeconds("270:00")) return 30; if (s > timeToSeconds("240:00")) return 35; if (s > timeToSeconds("215:00")) return 40; if (s > timeToSeconds("194:00")) return 45; if (s > timeToSeconds("176:00")) return 50; if (s > timeToSeconds("161:00")) return 55; if (s > timeToSeconds("148:00")) return 60; if (s > timeToSeconds("136:30")) return 65; return 70; };
        
        const R = (workout, volume) => ({ workout, volume });
        const D = R("Descanso", 0);

        VDOTApp.plans = {
            '5k-3': {
                description: "3 dias/semana. Qualidade na Segunda e Quarta, treino mais longo na Sexta.",
                data: [
                    [R("10 min (E) + 6x 400m (I) + 10 min (E)", 7), D, R("10 min (E) + 15 min (T) + 10 min (E)", 7), D, R("45 min em Ritmo F√°cil (E)", 7), D, D],
                    [R("10 min (E) + 8x 400m (I) + 10 min (E)", 8), D, R("10 min (E) + 20 min (T) + 10 min (E)", 8), D, R("50 min em Ritmo F√°cil (E)", 8), D, D],
                    [R("10 min (E) + 4x 800m (I) + 10 min (E)", 9), D, R("10 min (E) + 4x 5 min (T) + 10 min (E)", 9), D, R("60 min em Ritmo F√°cil (E)", 10), D, D],
                    [R("10 min (E) + 2x 1000m (I) + 10 min (E)", 7), D, R("30 min em Ritmo F√°cil (E)", 5), D, R("REAVALIA√á√ÉO! Teste de 3km.", 5), D, D]
                ]
            },
            '5k-4': {
                description: "4 dias/semana. Estrutura eficiente com treinos de qualidade e longo no fim de semana.",
                data: [
                    [D, R("10 min (E) + 6x 400m (I) + 10 min (E)", 7), R("30 min (E)", 5), D, R("10 min (E) + 15 min (T) + 10 min (E)", 7), D, R("45 min (E)", 8)],
                    [D, R("10 min (E) + 8x 400m (I) + 10 min (E)", 8), R("35 min (E)", 6), D, R("10 min (E) + 20 min (T) + 10 min (E)", 8), D, R("50 min (E)", 9)],
                    [D, R("10 min (E) + 4x 800m (I) + 10 min (E)", 9), R("40 min (E)", 7), D, R("10 min (E) + 4x 5 min (T) + 10 min (E)", 9), D, R("60 min (E)", 10)],
                    [D, R("10 min (E) + 2x 1000m (I) + 10 min (E)", 7), R("30 min (E)", 5), D, R("20 min (E) + 4x strides", 4), D, R("REAVALIA√á√ÉO! Teste de 3km.", 5)]
                ]
            },
            '5k-5': {
                description: "5 dias/semana. Volume ideal para performance m√°xima nos 5km.",
                data: [
                    [D, R("10 min (E) + 6x 400m (I) + 10 min (E)", 7), R("30 min (E)", 5), R("10 min (E) + 15 min (T) + 10 min (E)", 7), R("30 min (E)", 5), R("45 min (E)", 8), D],
                    [D, R("10 min (E) + 8x 400m (I) + 10 min (E)", 8), R("35 min (E)", 6), R("10 min (E) + 20 min (T) + 10 min (E)", 8), R("35 min (E)", 6), R("50 min (E)", 9), D],
                    [D, R("10 min (E) + 4x 800m (I) + 10 min (E)", 9), R("40 min (E)", 7), R("10 min (E) + 4x 5 min (T) + 10 min (E)", 9), R("40 min (E)", 7), R("60 min (E)", 10), D],
                    [D, R("10 min (E) + 2x 1000m (I) + 10 min (E)", 7), R("30 min (E)", 5), R("30 min (E) + 4x strides", 5), R("30 min (E)", 5), R("REAVALIA√á√ÉO! Teste de 3km.", 5), D]
                ]
            },
            '10k-3': {
                description: "3 dias/semana. Treinos chave na Segunda e Quarta, Longo na Sexta.",
                data: [
                    [R("10 min (E) + 20 min (T) + 10 min (E)", 9), D, R("45 min (E)", 8), D, R("75 min Longo (E)", 13), D, D],
                    [R("10 min (E) + 5x 800m (I) + 10 min (E)", 11), D, R("50 min (E)", 9), D, R("90 min Longo (E)", 16), D, D],
                    [R("10 min (E) + 3x 1600m (T) + 10 min (E)", 12), D, R("50 min (E)", 9), D, R("100 min Longo (E)", 18), D, D],
                    [R("10 min (E) + 4x 400m (I) + 10 min (E)", 6), D, R("40 min (E)", 7), D, R("REAVALIA√á√ÉO! Teste de 5km.", 7), D, D]
                ]
            },
            '10k-4': {
                description: "4 dias/semana. Plano balanceado para um √≥timo resultado nos 10km.",
                data: [
                    [D, R("10 min (E) + 20 min (T) + 10 min (E)", 9), R("40 min (E)", 7), D, R("10 min (E) + 6x 400m (I) + 10 min (E)", 8), D, R("75 min Longo (E)", 13)],
                    [D, R("10 min (E) + 3x 10 min (T) + 10 min (E)", 11), R("45 min (E)", 8), D, R("10 min (E) + 5x 800m (I) + 10 min (E)", 11), D, R("90 min Longo (E)", 16)],
                    [D, R("10 min (E) + 3x 1600m (T) + 10 min (E)", 12), R("50 min (E)", 9), D, R("10 min (E) + 6x 600m (I) + 10 min (E)", 10), D, R("100 min Longo (E)", 18)],
                    [D, R("10 min (E) + 15 min (T) + 10 min (E)", 7), R("40 min (E)", 7), D, R("20 min (E) + 4x strides", 4), D, R("REAVALIA√á√ÉO! Teste de 5km.", 7)]
                ]
            },
            '10k-5': {
                description: "5 dias/semana. Volume completo para atletas dedicados aos 10km.",
                data: [
                    [D, R("10 min (E) + 20 min (T) + 10 min (E)", 9), R("40 min (E)", 7), R("10 min (E) + 6x 400m (I) + 10 min (E)", 8), R("40 min (E)", 7), R("75 min Longo (E)", 13), D],
                    [D, R("10 min (E) + 3x 10 min (T) + 10 min (E)", 11), R("45 min (E)", 8), R("10 min (E) + 5x 800m (I) + 10 min (E)", 11), R("45 min (E)", 8), R("90 min Longo (E)", 16), D],
                    [D, R("10 min (E) + 3x 1600m (T) + 10 min (E)", 12), R("50 min (E)", 9), R("10 min (E) + 6x 600m (I) + 10 min (E)", 10), R("50 min (E)", 9), R("100 min Longo (E)", 18), D],
                    [D, R("10 min (E) + 15 min (T) + 10 min (E)", 7), R("40 min (E)", 7), R("30 min (E)", 5), R("20 min (E) + 4x strides", 4), R("REAVALIA√á√ÉO! Teste de 5km.", 7), D]
                ]
            },
             '21k-3': { description: "3 dias/semana. Foco total em Limiar e Longo para a meia.", data: [ [R("10 min (E) + 20 min (T) + 10 min (E)", 9), D, R("60 min (E)", 10), D, R("90 min Longo (E)", 16), D, D], [R("10 min (E) + 3x 1600m (T) + 10 min (E)", 12), D, R("60 min (E) com 15 min (M)", 11), D, R("100 min Longo (E)", 18), D, D], [R("10 min (E) + 4x 2km (T) + 10 min (E)", 15), D, R("60 min (E)", 10), D, R("120 min Longo com 2x15 min (M)", 22), D, D], [R("10 min (E) + 15 min (T) + 10 min (E)", 7), D, R("40 min (E) + 4x strides", 7), D, R("REAVALIA√á√ÉO! Teste de 10km.", 12), D, D] ] },
            '21k-4': { description: "4 dias/semana. Resist√™ncia e velocidade para uma meia maratona forte.", data: [ [D, R("10 min (E) + 20 min (T) + 10 min (E)", 9), R("50 min (E)", 9), D, R("60 min (E)", 10), D, R("90 min Longo (E)", 16)], [D, R("10 min (E) + 3x 1600m (T) + 10 min (E)", 12), R("50 min (E)", 9), D, R("60 min (E) com 15 min (M)", 11), D, R("100 min Longo (E)", 18)], [D, R("10 min (E) + 4x 2km (T) + 10 min (E)", 15), R("60 min (E)", 10), D, R("60 min (E) com 20 min (M)", 11), D, R("120 min Longo com 2x15 min (M)", 22)], [D, R("10 min (E) + 15 min (T) + 10 min (E)", 7), R("40 min (E)", 7), D, R("30 min (E) + 4x strides", 5), D, R("REAVALIA√á√ÉO! Teste de 10km.", 12)] ] },
            '21k-5': { description: "5 dias/semana. Volume e qualidade para sua melhor performance na meia.", data: [ [D, R("10 min (E) + 20 min (T) + 10 min (E)", 9), R("50 min (E)", 9), R("50 min (E)", 9), R("60 min (E)", 10), R("90 min Longo (E)", 16), D], [D, R("10 min (E) + 3x 1600m (T) + 10 min (E)", 12), R("50 min (E)", 9), R("60 min (E) com 15 min (M)", 11), R("50 min (E)", 9), R("100 min Longo (E)", 18), D], [D, R("10 min (E) + 4x 2km (T) + 10 min (E)", 15), R("60 min (E)", 10), R("60 min (E) com 20 min (M)", 11), R("60 min (E)", 10), R("120 min Longo com 2x15 min (M)", 22), D], [D, R("10 min (E) + 15 min (T) + 10 min (E)", 7), R("40 min (E)", 7), R("30 min (E)", 5), R("30 min (E) + 4x strides", 5), R("REAVALIA√á√ÉO! Teste de 10km.", 12), D] ] },
            '42k-3': { description: "3 dias/semana. Plano essencial para completar o desafio da maratona.", data: [ [R("10 min (E) + 25 min (T) + 10 min (E)", 11), D, R("60 min (E) com 20 min (M)", 12), D, R("120 min Longo (E)", 22), D, D], [R("10 min (E) + 10km em ritmo (M) + 10 min (E)", 16), D, R("60 min (E)", 11), D, R("150 min Longo (E)", 27), D, D], [R("15 min (E) + 2x 4km (T) + 10 min (E)", 15), D, R("60 min (E) com 30 min (M)", 13), D, R("180 min Longo (E)", 32), D, D], [R("10 min (E) + 15 min (T) + 10 min (E)", 8), D, R("30 min (E) + 4x strides", 6), D, R("PROVA 42KM", 42), D, D] ] },
            '42k-4': { description: "4 dias/semana. Um plano s√≥lido com volume e treinos chave para a Maratona.", data: [ [D, R("10 min (E) + 25 min (T) + 10 min (E)", 11), R("60 min (E)", 11), D, R("60 min (E) com 20 min (M)", 12), D, R("120 min Longo (E)", 22)], [D, R("10 min (E) + 10km em ritmo (M) + 10 min (E)", 16), R("60 min (E)", 11), D, R("60 min (E)", 11), D, R("150 min Longo (E)", 27)], [D, R("15 min (E) + 2x 4km (T) + 10 min (E)", 15), R("60 min (E)", 11), D, R("60 min (E) com 30 min (M)", 13), D, R("180 min Longo (E)", 32)], [D, R("10 min (E) + 15 min (T) + 10 min (E)", 8), R("45 min (E)", 8), D, R("30 min (E) + 4x strides", 6), D, R("PROVA 42KM", 42)] ] },
            '42k-5': { description: "5 dias/semana. Prepara√ß√£o completa para sua melhor maratona.", data: [ [D, R("10 min (E) + 25 min (T) + 10 min (E)", 11), R("60 min (E)", 11), R("60 min (E) com 20 min (M)", 12), R("60 min (E)", 11), R("120 min Longo (E)", 22), D], [D, R("10 min (E) + 10km em ritmo (M) + 10 min (E)", 16), R("60 min (E)", 11), R("15 min (E) + 2x 4km (T) + 10 min (E)", 15), R("60 min (E)", 11), R("150 min Longo (E)", 27), D], [D, R("10 min (E) + 12km em ritmo (M) + 10 min (E)", 19), R("60 min (E)", 11), R("15 min (E) + 3x 3km (T) + 10 min (E)", 17), R("60 min (E)", 11), R("180 min Longo (E)", 32), D], [D, R("10 min (E) + 15 min (T) + 10 min (E)", 8), R("45 min (E)", 8), R("30 min (E)", 6), R("20 min (E) leve", 3), R("PROVA 42KM", 42), D] ] }
        };
        
        VDOTApp.state = {
            currentObjective: '5k',
            currentDays: '4',
            completedWorkouts: [],
        };
        
        let progressChartInstance, volumeChartInstance;

        VDOTApp.updateCharts = () => {
            const planKey = `${VDOTApp.state.currentObjective}-${VDOTApp.state.currentDays}`;
            const currentPlanData = VDOTApp.plans[planKey].data;
            
            const flattenedPlan = currentPlanData.flat();
            const completedCount = VDOTApp.state.completedWorkouts.filter(Boolean).length;
            const totalCount = flattenedPlan.length;
            const percentage = totalCount > 0 ? Math.round((completedCount / totalCount) * 100) : 0;

            document.getElementById('progress-text').textContent = `${percentage}%`;
            if (progressChartInstance) { progressChartInstance.data.datasets[0].data = [completedCount, totalCount - completedCount]; progressChartInstance.update(); }
            
            const weeklyVolumes = currentPlanData.map(week => 
                week.reduce((totalVolume, day) => totalVolume + day.volume, 0)
            );
            
            if(volumeChartInstance) { 
                volumeChartInstance.data.labels = weeklyVolumes.map((_, i) => `Semana ${i + 1}`);
                volumeChartInstance.data.datasets[0].data = weeklyVolumes; 
                volumeChartInstance.update();
            }
        }
        
        VDOTApp.createInitialCharts = () => {
             const progressCtx = document.getElementById('progressChart').getContext('2d');
             progressChartInstance = new Chart(progressCtx, { type: 'doughnut', data: { labels: ['Conclu√≠dos', 'Pendentes'], datasets: [{ data: [0, 100], backgroundColor: ['#22c55e', '#e5e7eb'], borderColor: ['#ffffff'], borderWidth: 3 }] }, options: { responsive: true, cutout: '80%', plugins: { legend: { display: false }, tooltip: { enabled: false } } } });
             const volumeCtx = document.getElementById('volumeChart').getContext('2d');
             volumeChartInstance = new Chart(volumeCtx, { type: 'bar', data: { labels: [], datasets: [{ label: 'Volume (km)', data: [], backgroundColor: '#3b82f6', borderRadius: 5 }] }, options: { responsive: true, plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true, grid: { drawOnChartArea: false } }, x: { grid: { display: false } } } } });
        }

        VDOTApp.renderPaces = (vdot) => {
            const paces = VDOTApp.vdotData[vdot];
            document.getElementById('paces-table-body').innerHTML = `<tr class="border-b bg-green-50"><td class="font-semibold p-3">F√°cil (E)</td><td>${paces.E}</td><td>-</td></tr><tr class="border-b bg-yellow-50"><td class="font-semibold p-3">Maratona (M)</td><td>${paces.M}</td><td>-</td></tr><tr class="border-b bg-orange-50"><td class="font-semibold p-3">Limiar (T)</td><td>${paces.T}</td><td>-</td></tr><tr class="border-b bg-red-50"><td class="font-semibold p-3">Intervalado (I)</td><td>${paces.I}</td><td>${paces.pace400I}</td></tr><tr class="bg-purple-50"><td class="font-semibold p-3">Repeti√ß√£o (R)</td><td>${paces.R}</td><td>-</td></tr>`;
        };

        VDOTApp.renderPlan = () => {
            const planKey = `${VDOTApp.state.currentObjective}-${VDOTApp.state.currentDays}`;
            const plan = VDOTApp.plans[planKey];
            if (!plan) { 
                console.error("Plano n√£o encontrado para a chave:", planKey);
                return;
            }

            const planData = plan.data;
            document.getElementById('plan-description').textContent = plan.description;
            const flattenedPlan = planData.flat();
            VDOTApp.state.completedWorkouts = new Array(flattenedPlan.length).fill(false);
            
            const table = document.getElementById('training-plan-table');
            const dayNames = ["SEG", "TER", "QUA", "QUI", "SEX", "S√ÅB", "DOM"];
            let globalIndex = 0;
            
            let html = '';
            planData.forEach((week, weekIndex) => {
                html += `<thead class="text-xs text-gray-700 uppercase bg-gray-100"><th colspan="3" class="px-6 py-3">Semana ${weekIndex + 1}</th></thead>`;
                html += '<tbody class="bg-white">';
                week.forEach((day, dayIndex) => {
                    html += `
                        <tr id="row-${globalIndex}" class="border-b">
                            <td class="w-24 text-center font-medium">${dayNames[dayIndex]}</td>
                            <td>${day.workout}</td>
                            <td class="w-20 text-center">
                                ${day.volume > 0 ? `<input type="checkbox" data-index="${globalIndex}" class="w-5 h-5 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 workout-checkbox">` : ''}
                            </td>
                        </tr>
                    `;
                    globalIndex++;
                });
                html += '</tbody>';
            });

            table.innerHTML = html;
            VDOTApp.updateCharts();
        };
        
        VDOTApp.handleCalculate = () => {
            const distance = document.getElementById('race-distance').value;
            let vdot;

            if (distance === 'beginner') {
                vdot = 30;
                document.getElementById('beginner-note').classList.remove('hidden');
            } else {
                document.getElementById('beginner-note').classList.add('hidden');
                const h = parseInt(document.getElementById('race-hours').value) || 0;
                const m = parseInt(document.getElementById('race-minutes').value) || 0;
                const s = parseInt(document.getElementById('race-seconds').value) || 0;
                const totalSeconds = (h * 3600) + (m * 60) + s;
            
                if (distance === "5000") vdot = VDOTApp.getVdotFrom5k(totalSeconds);
                else if (distance === "10000") vdot = VDOTApp.getVdotFrom10k(totalSeconds);
                else if (distance === "21097") vdot = VDOTApp.getVdotFrom21k(totalSeconds);
                else vdot = VDOTApp.getVdotFrom42k(totalSeconds);
            }
            
            document.getElementById('vdot-score').textContent = vdot;
            VDOTApp.renderPaces(vdot);
            document.getElementById('results-area').classList.remove('hidden');
        };

        VDOTApp.handleTableClick = (event) => {
             const target = event.target;
             const index = target.dataset.index;
             if (index !== undefined && target.classList.contains('workout-checkbox')) {
                VDOTApp.state.completedWorkouts[index] = target.checked;
                document.getElementById(`row-${index}`).classList.toggle('completed-row', target.checked);
                VDOTApp.updateCharts();
             }
        };

        VDOTApp.handlePlanSelection = () => {
            VDOTApp.state.currentObjective = document.getElementById('plan-objective').value;
            VDOTApp.state.currentDays = document.getElementById('plan-days').value;
            VDOTApp.renderPlan();
        };

        VDOTApp.handleDistanceChange = (event) => {
            const timeInputs = document.getElementById('time-inputs');
            if (event.target.value === 'beginner') {
                timeInputs.classList.add('hidden');
            } else {
                timeInputs.classList.remove('hidden');
            }
        };
        
        VDOTApp.init = () => {
            document.getElementById('calculate-btn').addEventListener('click', VDOTApp.handleCalculate);
            document.getElementById('training-plan-table').addEventListener('click', VDOTApp.handleTableClick);
            document.getElementById('plan-objective').addEventListener('change', VDOTApp.handlePlanSelection);
            document.getElementById('plan-days').addEventListener('change', VDOTApp.handlePlanSelection);
            document.getElementById('race-distance').addEventListener('change', VDOTApp.handleDistanceChange);
            
            VDOTApp.createInitialCharts();
            VDOTApp.handleDistanceChange({ target: document.getElementById('race-distance') });
            VDOTApp.renderPlan();
            VDOTApp.handleCalculate();
        };

        VDOTApp.init();

        onAuthStateChanged(auth, user => {
            if (user) {
                document.getElementById('userIdDisplay').textContent = user.uid;
            } else {
                signInAnonymously(auth).catch(error => {
                    console.error("Anonymous sign-in failed:", error);
                });
            }
        });
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/flowbite/1.8.1/flowbite.min.js"></script>

</body>
</html>
